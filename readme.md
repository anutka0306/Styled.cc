# Fuelfuture.ru (Symfony 5)
## Минимальные требования:
- PHP 7.3  и выше
- MySQL 5.6 и выше

## Установка:

- Склонировать репозиторий
- Скопировать БД с основного сайта
- В корневой дирректории проекта создать файл ".env.local". В файл добавить следующие строки:
```
APP_ENV=dev
DATABASE_URL=mysql://user:password@127.0.0.1:3306/db_name
```
- Заменить **user**, **password**, **db_name** данными для подключения к локально БД
- В корневой папке проекта через терминал выполнить:
```console
composer install
```
## Работа с Фронт-эндом (JS и CSS)
Сборка осуществляется посредством [WebPack](https://webpack.js.org/). Для настройки которого используется [Encore](https://symfony.com/doc/current/frontend.html)
1. Установить глобально Node.js
2. Установить зависимости - в папке проекта выполнить:
```console
yarn install
```
3. Запустить сервер разработки с автоматической пересборкой:
```console
yarn watch
```
4. JS и CSS (SCSS) хранятся в папке /frontend/
5. Подключение JS осуществляется в файле frontend/app.js с помощью синтаксиса импорта:
```js
import './blocks/section/callback/callback-popup'
```
6. Подключение SCSS/SASS осуществляется в файле frontend/blocks/main.sass с помощью синтаксиса импорта:
```
@import section/hero/hero;
```
7. Настройка WebPack в файле - webpack.config.js
8. Сборка для *production-сайта* (выполняется на локальной машине!):
```console
yarn encore production
```
По окончанию сборки необходимо удалить на продакшене папку public_html/build и залить эту папку на продакшен с локальной машины.
## Настройка отправки почты в dev-режиме
Для тестирования отправки почты в процессе разработки можно использовать Gmail или Mailtrap
### Отправка через Gmail:
Gmail-транспорт уже установлен. Нужно лишь в **.env.local** добавить строку для настройки подключения:
```
MAILER_DSN=gmail://GMAIL_LOGIN:GMAIL_PASSWORD@default
```
Вместо **GMAIL_LOGIN** и **GMAIL_PASSWORD** указать свои логин и пароль от аккаунта Gmail. В настройках этого аккаунта нужно разрешить [использование небезопасных приложений](https://myaccount.google.com/lesssecureapps)
### Отправка через MailTrap:
Сервис MailTrap не производит реальную отправку писем, а лишь собирает их в виртуальном почтовом ящике, который доступен только Вам
1. Необходимо зарегистрировать аккаунт в [MailTrap](https://mailtrap.io)
2. Выбрать бесплатный план
3. Перейти в настройки ящика и взять от туда логин и пароль
4. Добавить строку подключения в **.env.local**:
```
MAILER_DSN=smtp://LOGIN:PASSWORD@smtp.mailtrap.io:25
```
Вместо **LOGIN** и **PASSWORD** указать свои логин и пароль из настроек ящика.
### Подмена получателей:
Для того, чтобы письма отправлялись не реальным адресатам, а на Ваш E-mail необходимо указать этот Email в файле **.env.local** в переменной **DEV_MAIL_RECIPIENT**:
```
DEV_MAIL_RECIPIENT="your-mail@gmail.com"
```
## Тестирование
Большая часть функционала сайта покрыта функциональными, интеграционными и модульными(unit) тестами.
Для запуска тестов используется команда в терминале:
```console
php bin/phpunit
```
По-умолчанию письма при тестировании никуда не отправляются, т.к. используется null-транспорт.

При желании можно переопределить транспорт в файле **.env.test.loacal**. Для этого нужно добавить правильную строку подключения в переменной **MAILER_DSN** (см. "Настройка отправки почты в dev-режиме")
## Карта сайта и YML-файл
Карта сайта и YML-файл генерируются при обращении к следующим адресам:
- /sitemap_generator - карта сайта. Будет доступна по адресу /sitemap.xml
- /yml_generator - YML-файл будет доступен по адресу /yml/index.xml

## Консоль Symfony:
Для удобного доступа к консоли можно использовать Bash-скрипт - ./console
Пример использования:
```console
./console cache:clear
./console debug:router
```

## Создать пользователя:
С помощью команды можно создать пользователя **admin** с паролем **password**
```console
php bin/console user:create admin password
```
Изменить пароль можно так:
```console
php bin/console user:change-password admin new_password
```

## Работа с файлами шаблона (.html.twig):
- После внесения любых изменений в файлы .php и .twig на production-сайте, нужно чистить кэш. Для этого нужно по SSH войти в корневую папку проекта и выполнить команду:
```console
php bin/console cache:clear
```
или через запуск Bash-скрипта:
```console
./cc
```
- Комментарии в файлах .twig делать таким образом:
```
{# Текст комментария #}
```
- [Подробнее про шаблонизатор Twig](https://twig.symfony.com/doc/2.x/)